<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Amazon Price Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 400px; margin: auto; }
        .success { color: green; }
        .danger { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Add a Product to Track</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        <form method="post">
            <label for="url">Amazon Product URL:</label><br>
            <input type="url" id="url" name="url" required style="width:100%"><br><br>
            <label for="threshold">Price Threshold:</label><br>
            <input type="number" id="threshold" name="threshold" step="0.01" required style="width:100%"><br><br>
            <button type="submit">Add Product</button>
        </form>
    </div>
    <div class="container" style="margin-top:40px;">
        <h2>Price History</h2>
        {% for url, history in price_history_by_product.items() %}
        <h3>Product: <a href="{{ url }}" target="_blank">{{ url }}</a></h3>
        <table border="1" style="width:100%; margin-bottom:30px;">
            <tr>
                <th>Timestamp</th>
                <th>Price</th>
            </tr>
            {% for row in history %}
            <tr>
                <td>{{ row.timestamp }}</td>
                <td>{{ row.price }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endfor %}
    </div>
</body>
</html>